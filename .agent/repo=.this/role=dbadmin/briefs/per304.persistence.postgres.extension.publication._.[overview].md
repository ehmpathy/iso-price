# iso_price postgresql extension publication

overview of publication channels for the iso_price extension.

→ for implementation details, see [per303.implementation](./per303.persistence.postgres.extension.implementation.[guide].md)
→ for usage guide, see [per302.extension](./per302.persistence.postgres.extension.[article].md)
→ for distribution methods, see [per305.distribution](./per305.persistence.postgres.extension.distribution.[article].md)

---

## tl;dr

| channel | artifact | best for | `CREATE EXTENSION`? |
|---------|----------|----------|---------------------|
| **npm** ⭐ | `iso-price` package | node.js projects (all platforms) | ❌ no |
| **raw sql** | `iso_price.init.sql` | non-node.js projects | ❌ no |
| **pgxn** | `.zip` package | self-hosted + want `CREATE EXTENSION` | ✅ yes |
| **pg_tle** | `pgtle.install_extension()` | aws + want `CREATE EXTENSION` | ✅ yes |

⭐ = recommended for simplicity and portability

---

## recommendation: npm + sql-schema-control

**for maximum portability with minimum complexity: npm + migration**

```sh
npm install iso-price
cp node_modules/iso-price/dist/postgres/iso_price.init.sql schema/changes/install.iso_price.sql
```

then add to `schema/control.yml`:

```yaml
- type: change
  path: ./changes/install.iso_price.sql
  id: install_iso_price_extension
```

**why this is the simplest:**

| consideration | npm + migration |
|---------------|-----------------|
| works on aws rds/aurora | ✅ yes |
| works on supabase/neon/gcp/azure | ✅ yes |
| works on self-hosted | ✅ yes |
| requires pg_tle setup | ❌ no |
| requires filesystem access | ❌ no |
| version management | via npm + migration history |
| install steps | 1 (run migration) |

**tradeoff:** no `CREATE EXTENSION` syntax or `\dx` visibility. but for projects that already use migration-based schema management, this is a non-issue — the migration history is your source of truth.

**when to use other channels:**
- **pgxn**: you're self-hosted and want `CREATE EXTENSION` workflow
- **pg_tle**: you're on aws and dbas expect `CREATE EXTENSION` workflow
- **raw sql**: you're not in a node.js ecosystem

→ see [per304.via_npm](./per304.persistence.postgres.extension.publication.via_npm.[guide].md) for full details

---

## publication channels

### via pgxn

the postgresql extension network — open registry for native extensions.

- **publisher**: upload `.zip` with `META.json` + control file + sql
- **consumer**: `pgxn install iso_price` then `CREATE EXTENSION iso_price`
- **platforms**: self-hosted postgres only (requires filesystem)

→ [per304.via_pgxn](./per304.persistence.postgres.extension.publication.via_pgxn.[guide].md)

### via pg_tle

aws trusted language extensions — database-stored extension registry.

- **publisher**: wrap sql in `pgtle.install_extension()` call
- **consumer**: run registration sql, then `CREATE EXTENSION iso_price`
- **platforms**: aws rds/aurora, self-hosted

→ [per304.via_pgtle](./per304.persistence.postgres.extension.publication.via_pgtle.[guide].md)

### via raw sql

standalone sql file — universal fallback.

- **publisher**: github release with `.sql` artifact
- **consumer**: `psql -f iso_price.init.sql`
- **platforms**: all postgres (no `CREATE EXTENSION` syntax)

→ [per304.via_sql](./per304.persistence.postgres.extension.publication.via_sql.[guide].md)

### via npm

node.js package with embedded sql — for programmatic installation.

- **publisher**: npm package with sql files and typescript exports
- **consumer**: `npm install iso-price` + migration
- **platforms**: node.js projects on any postgres

→ [per304.via_npm](./per304.persistence.postgres.extension.publication.via_npm.[guide].md)

---

## build artifacts

the build process generates all artifacts from the implementation reference.

```
dist/
  postgres/
    iso_price.init.sql               # raw sql (all platforms)
    iso_price.control                # pgxn control file
    iso_price--1.0.0.sql             # pgxn versioned sql
    iso_price--1.0.0.pgtle.sql       # pg_tle wrapped
    META.json                        # pgxn metadata
```

---

## version strategy

### semver policy

| version | indicates | example |
|---------|-----------|---------|
| major | incompatible changes | new type signature |
| minor | new features | new function added |
| patch | bug fixes | comparison edge case |

### version parity

all artifacts must declare the same version:

```
package.json          → "version": "1.0.0"
META.json             → "version": "1.0.0"
iso_price.control     → default_version = '1.0.0'
iso_price.init.sql    → -- Version: 1.0.0
iso_price.pgtle.sql   → 'iso_price', '1.0.0', ...
```

---

## consumer decision matrix

| scenario | recommended | guide |
|----------|-------------|-------|
| **node.js project (any platform)** | **npm** ⭐ | [via_npm](./per304.persistence.postgres.extension.publication.via_npm.[guide].md) |
| self-hosted + want `CREATE EXTENSION` | pgxn | [via_pgxn](./per304.persistence.postgres.extension.publication.via_pgxn.[guide].md) |
| aws rds/aurora + want `CREATE EXTENSION` | pg_tle | [via_pgtle](./per304.persistence.postgres.extension.publication.via_pgtle.[guide].md) |
| non-node.js project | raw sql | [via_sql](./per304.persistence.postgres.extension.publication.via_sql.[guide].md) |

⭐ = simplest portable option for most projects

---

## ci/cd pipeline

### recommended workflow

```yaml
# .github/workflows/release.yml
name: release
on:
  push:
    tags: ['v*']

jobs:
  release:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm ci
      - run: npm run build
      - run: npm run test:postgres

      # github release
      - uses: softprops/action-gh-release@v1
        with:
          files: dist/postgres/*

      # npm publish
      - run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

      # pgxn publish (optional)
      - run: pgxn-upload dist/iso_price-*.zip
        env:
          PGXN_USERNAME: ${{ secrets.PGXN_USERNAME }}
          PGXN_PASSWORD: ${{ secrets.PGXN_PASSWORD }}
```

---

## sources

- [per304.via_pgxn](./per304.persistence.postgres.extension.publication.via_pgxn.[guide].md)
- [per304.via_pgtle](./per304.persistence.postgres.extension.publication.via_pgtle.[guide].md)
- [per304.via_sql](./per304.persistence.postgres.extension.publication.via_sql.[guide].md)
- [per304.via_npm](./per304.persistence.postgres.extension.publication.via_npm.[guide].md)
