# research.claims = iso-price

research conducted to inform the `iso-price` package design, focused on ISO standards for currency, price representation, and industry best practices.

---

## 1. iso 4217 - currency codes standard

### [FACT] iso 4217 defines the international standard for currency representation

> "ISO 4217 is a standard published by the International Organization for Standardization (ISO) that defines alpha codes and numeric codes for the representation of currencies and provides information about the relationships between individual currencies and their minor units."

— [ISO 4217 - Wikipedia](https://en.wikipedia.org/wiki/ISO_4217) [1]

### [FACT] iso 4217 uses three-letter alphabetic codes

> "The first two letters of the ISO 4217 three-letter code are the same as the code for the country name, and, where possible, the third letter corresponds to the first letter of the currency name."

— [ISO - ISO 4217 Currency Codes](https://www.iso.org/iso-4217-currency-codes.html) [2]

### [FACT] iso 4217 also defines three-digit numeric codes

> "ISO 4217 also assigns a three-digit numeric code to each currency."

— [ISO - ISO 4217 Currency Codes](https://www.iso.org/iso-4217-currency-codes.html) [2]

### [FACT] iso allows free use of currency codes

> "ISO allows free-of-charge use of its country, currency and language codes from ISO 3166, ISO 4217 and ISO 639, respectively."

— [ISO 4217 - Wikipedia](https://en.wikipedia.org/wiki/ISO_4217) [1]

### [FACT] the standard is maintained by six financial information ag

> "Periodically, amendments must be made to ISO 4217:2015 and these are managed by the Secretariat of the Maintenance Agency, in this case the SIX Financial Information AG on behalf of the Swiss Association for Standardization, SNV."

— [ISO - ISO 4217 Currency Codes](https://www.iso.org/iso-4217-currency-codes.html) [2]

---

## 2. minor units and decimal places

### [FACT] iso 4217 specifies minor units for each currency

> "For those currencies having minor units, it also shows the decimal relationship between such units and the currency itself."

— [ISO 4217 - Wikipedia](https://en.wikipedia.org/wiki/ISO_4217) [1]

### [FACT] minor unit codes indicate decimal ratios

> "'0' means that there is no minor unit for that currency, whereas '1', '2' and '3' signify a ratio of 10:1, 100:1 and 1000:1 respectively."

— [Currency codes and minor units | Adyen Docs](https://docs.adyen.com/development-resources/currency-codes/) [3]

### [FACT] most currencies have 2 decimal places

> "Exponent 2 (Two decimals, most common): EUR, CHF, GBP, USD, and any other currency."

— [Currency codes and minor units | Adyen Docs](https://docs.adyen.com/development-resources/currency-codes/) [3]

### [FACT] zero-decimal currencies exist (jpy, krw, etc.)

> "Currencies with Exponent 0 (No decimals) include: BIF, BYR, CLF, DJF, GNF, ISK, JPY, KMF, KRW, PYG, RWF, UGX, UYI, VND, VUV, XAF, XOF, XPF."

— [Currency codes and minor units | Adyen Docs](https://docs.adyen.com/development-resources/currency-codes/) [3]

### [FACT] three-decimal currencies exist (bhd, kwd, etc.)

> "Exponent 3 (Three decimals): BHD, IQD, JOD, KWD, LYD, OMR, TND."

— [Currency codes and minor units | Adyen Docs](https://docs.adyen.com/development-resources/currency-codes/) [3]

### [FACT] two currencies have non-decimal ratios (5:1)

> "As of 2021, two currencies have non-decimal ratios, the Mauritanian ouguiya and the Malagasy ariary; in both cases the ratio is 5:1."

— [ISO 4217 - Wikipedia](https://en.wikipedia.org/wiki/ISO_4217) [1]

---

## 3. stripe's smallest currency unit approach

### [FACT] stripe requires amounts in smallest currency unit

> "All API requests expect amount values in the currency's minor unit. For example, enter 1000 to charge 10 USD (or any other two-decimal currency), and 10 to charge 10 JPY (or any other zero-decimal currency)."

— [Supported currencies | Stripe Documentation](https://docs.stripe.com/currencies) [4]

### [FACT] stripe defines amount as positive integer in smallest unit

> "Amounts must be 'a positive integer representing how much to charge in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge ¥100, a zero-decimal currency).'"

— [The Charge object | Stripe API Reference](https://docs.stripe.com/api/charges/object) [5]

### [FACT] stripe supports up to 8 digits for amounts

> "The amount value supports up to eight digits (e.g., a value of 99999999 for a USD charge of $999,999.99)."

— [Supported currencies | Stripe Documentation](https://docs.stripe.com/currencies) [4]

### [SUMP] the stripe approach (integers in minor units) is industry best practice

> "One of the popular approaches (Stripe approach) is storing an integer number of minor units. Simply put, you store 5 $ as 500 cents. This way you can do accurate calculations and comparisons internally and then display the result formatting the number in a proper way as an amount of dollars."

— [Storing currency values: data types, caveats, best practices](https://cardinalby.github.io/blog/post/best-practices/storing-currency-values-data-types/) [6]

---

## 4. iso 20022 - financial services message scheme

### [FACT] iso 20022 is the global financial services message scheme

> "First published in 2004, ISO 20022, Financial services – Universal financial industry message scheme, is widely recognized as the standard of the future."

— [ISO 20022: Standards | Swift](https://www.swift.com/standards/iso-20022/iso-20022-standards) [7]

### [FACT] iso 20022 uses iso 4217 for currency codes

> "In ISO 20022, currencies are represented using the ISO 4217 three-letter alpha code."

— [Currency and Amount – ISO 20022 payments](https://www.iso20022payments.com/miscellaneous/currency-and-amount/) [8]

### [FACT] iso 20022 allows up to 14 digits with 5 fractional digits

> "Amounts can have up to 14 digits with up to 5 fractional digits."

— [Currency and Amount – ISO 20022 payments](https://www.iso20022payments.com/miscellaneous/currency-and-amount/) [8]

### [FACT] iso 20022 requires decimal compliance with iso 4217

> "Not only must the Currency Code comply with ISO 4217 but also the number of fractional digits must comply with ISO 4217."

— [Currency and Amount – ISO 20022 payments](https://www.iso20022payments.com/miscellaneous/currency-and-amount/) [8]

---

## 5. iso 21041 - unit price guidance

### [FACT] iso 21041 provides guidance on unit price display

> "This document gives principles and best practice guidelines for unit pricing displayed by written, printed or electronic means."

— [ISO 21041:2018 - Guidance on unit pricing](https://www.iso.org/standard/69727.html) [9]

---

## 6. martin fowler's money pattern

### [FACT] money is not a first-class type in mainstream languages

> "Martin Fowler has noted that 'a large proportion of the computers in this world manipulate money, so it's always puzzled me that money isn't actually a first class data type in any mainstream programming language.'"

— [Money | Martin Fowler](https://martinfowler.com/eaaCatalog/money.html) [10]

### [FACT] the money pattern encapsulates amount and currency

> "The Money Pattern is basically a class encapsulating an amount and currency. Then it defines all the mathematical operations on the value with respect to the currency."

— [Fowler's Money Pattern: Precise Currency Handling in Code](https://mnorhamizan.com/fowlers-money-pattern-how-to-make-the-world-go-round/) [11]

### [FACT] multi-currency calculations require currency awareness

> "The lack of a money type causes problems, the most obvious surrounding currencies. If all calculations are done in a single currency, this isn't a huge problem, but once you involve multiple currencies you want to avoid adding dollars to yen without taking the currency differences into account."

— [Money | Martin Fowler](https://martinfowler.com/eaaCatalog/money.html) [10]

### [FACT] division remainder is a key concern

> "If you divide $100 by three, the answer is not simply $33.33. The problem is that if you multiply $33.33 you get $99.99 - meaning that a penny goes missing. Accountants don't like pennies to go missing."

— [Money | Martin Fowler](https://martinfowler.com/eaaCatalog/money.html) [10]

### [SUMP] fowler recommends biginteger or bigdecimal for amounts

> "The basic representation involves a class with a BigInteger for the amount and a Currency field. In Java, BigDecimal could also be used, but in many languages an integer is the only decent option."

— [Money | Martin Fowler](https://martinfowler.com/eaaCatalog/money.html) [10]

---

## 7. float problems with money

### [FACT] float cannot exactly represent most decimal values

> "Even when there's no issue with limited significant digits when numbers are relatively small, most simple monetary values can't be stored exactly using IEEE-754 floats. This is because the decimal numbers in the financial world are base 10, but computers deal with binary in base 2."

— [Floating Point Numbers & Currency Rounding Errors](https://spin.atomicobject.com/2014/08/14/currency-rounding-errors/) [12]

### [FACT] 0.1 cannot be represented exactly in binary float

> "Floats and doubles cannot accurately represent the base 10 multiples we use for money, so it is impossible to represent 0.1 (or any other negative power of ten)."

— [Why You Should Never Use Float and Double for Monetary Calculations](https://dzone.com/articles/never-use-float-and-double-for-monetary-calculatio) [13]

### [FACT] errors accumulate over many operations

> "Representing money as a double or float will probably look good at first as the software rounds off the tiny errors, but as you perform more additions, subtractions, multiplications and divisions on inexact numbers, you'll lose more and more precision as the errors add up."

— [Why You Should Never Use Float and Double for Monetary Calculations](https://dzone.com/articles/never-use-float-and-double-for-monetary-calculatio) [13]

### [FACT] real-world financial disasters have occurred from float errors

> "A major European bank discovered they had been miscalculating interest payments for over three years. A tiny floating point rounding issue accumulated to millions of euros in incorrect payments."

— [The Floating Point Standard That's Silently Breaking Financial Software](https://medium.com/@sohail_saifii/the-floating-point-standard-thats-silently-breaking-financial-software-7f7e93430dbb) [14]

### [SUMP] integers or bigdecimal should be used for monetary calculations

> "The solution to this problem is to use BigDecimal, int or long for monetary calculations."

— [Why You Should Never Use Float and Double for Monetary Calculations](https://dzone.com/articles/never-use-float-and-double-for-monetary-calculatio) [13]

### [KHUE] is float acceptable if you round every computation?

> "If you round the result of every computation, then you can get exactly correct financial calculations using floating-point numbers, for realistic ranges of values. However, the primary advantage of using an integer is that it forces you to think about the conversions, rather than blindly applying the calculations and forgetting about rounding."

— [You can use floating-point numbers for money](https://www.evanjones.ca/floating-point-money.html) [15]

### [FACT] financial round differs from computer round

> "In computers, usually the 'round to even' strategy is applied, as that provides the best numerical stability. This means that 2.5 is rounded down to 2, while 3.5 is rounded up to 4. On the other hand, in financial applications the general rule is that halves are always rounded up, that is 2.5 must be rounded up to 3."

— [Floats and money](https://evertpot.com/currencies-floats/) [16]

---

## 8. exchange rate representation

### [FACT] currency pairs use base and quote currency convention

> "A currency pair is two standard currency codes joined together: 'EURUSD', 'GBPUSD', 'GBPJPY', etc. The first currency in the pair is the base currency. The second is the quote currency. The result indicates how much of the quote currency is needed to buy one unit of the base currency."

— [Checking foreign exchange rates | Currencycloud](https://developer.currencycloud.com/guides/integration-guides/check-foreign-exchange-rates/) [17]

### [FACT] market conventions determine pair order

> "When getting a quote from detailed rate endpoints, the currency_pair property in the response will be standardised, adhering to market conventions for currency pair notation. It is conventional to represent a pairing of Euros to Pound Sterling as 'EURGBP', never 'GBPEUR', regardless which of the two currencies you are buying and selling."

— [Checking foreign exchange rates | Currencycloud](https://developer.currencycloud.com/guides/integration-guides/check-foreign-exchange-rates/) [17]

### [FACT] iso 4217 special codes exist for precious metals

> "Codes for the precious metals gold (XAU), silver (XAG), palladium (XPD), and platinum (XPT) are formed by prefixing the element's chemical symbol with the letter 'X'. These 'currency units' are defined as one troy ounce of the specified metal."

— [ISO 4217 - Wikipedia](https://en.wikipedia.org/wiki/ISO_4217) [1]

### [FACT] xts is reserved for test, xxx for no currency

> "The code XTS is reserved for use in testing. The code XXX is used to denote a 'transaction' involving no currency."

— [ISO 4217 - Wikipedia](https://en.wikipedia.org/wiki/ISO_4217) [1]

---

## 9. currency symbol position and localization

### [FACT] cldr provides international guidelines for currency format

> "CLDR is the recognized international standard and automatically formats numbers and currency based on the merchant's locale. It determines whether the currency symbol appears before or after the amount."

— [Formatting localized currency - Shopify Polaris](https://polaris-react.shopify.com/foundations/formatting-localized-currency) [18]

### [FACT] symbol position varies by locale

> "In English-speaking countries such as the United States and Canada, the currency symbol is usually placed before the numerical value (e.g., $100). Same goes for Asian countries like China and Japan."
>
> "In Canada (French), the symbol goes to the right of the amount (e.g., 1.234,56 $)."

— [Currency localization: Understanding the key elements](https://poeditor.com/blog/currency-localization/) [19]

### [FACT] decimal and thousands separators vary by locale

> "In the United States and the United Kingdom, a comma is used as a thousands separator, while a period is used for decimals. However, many European countries use a period as the thousands separator and a comma for decimals."

— [Format currency values | Microsoft Learn](https://learn.microsoft.com/en-us/globalization/locale/currency-formats) [20]

### [SUMP] iso 4217 codes are preferred over symbols for clarity

> "Currency codes, such as USD for the U.S. dollar or EUR for the Euro, follow the standardized ISO 4217 currency codes. These three-letter codes are unique and universally recognized, making them ideal for financial reporting and exchange rate listings. For example, 'USD 100' clearly indicates 100 U.S. dollars, avoiding confusion with other currencies that use the dollar symbol."

— [Currency Symbols Localization Guide](https://www.xtransfer.com/wiki/trade-terms/currency-symbols-localization-guide-for-beginners) [21]

---

## 10. typescript/javascript libraries (prior art)

### [FACT] dinero.js implements fowler's money pattern with immutability

> "Dinero.js lets you create, calculate, and format money safely in JavaScript and TypeScript. It follows Martin Fowler's money pattern, it's immutable, modular, side-effects free, generic, and natively supports TypeScript."

— [What is Dinero.js?](https://v2.dinerojs.com/docs) [22]

### [FACT] dinero.js is written in typescript

> "Dinero.js is written in TypeScript, granting you full type safety when manipulating money."

— [What is Dinero.js?](https://v2.dinerojs.com/docs) [22]

### [OPIN] immutability is safer for money operations

> "An immutable library is safer and more predictable. Mutable operations and reference copies are a source of bugs. Immutability avoids them altogether. Dinero.js lets you perform calculations without altering original instances."

— [What is Dinero.js?](https://v2.dinerojs.com/docs) [22]

### [FACT] currency-codes npm package provides iso 4217 data

> "currency-codes allows you to fetch the latest copy of ISO-4217 from the maintainer and update the library's currency data file."

— [currency-codes - npm](https://www.npmjs.com/package/currency-codes) [23]

### [FACT] money.ts uses iso 4217 codes and lowest unit amounts

> "Currency is an ISO-4217 alpha code (e.g., USD, JPY, EUR, SGD), and amount is represented in the currency's lowest unit (e.g., US$5.00 = 500 cents)."

— [GitHub - half0wl/money.ts](https://github.com/half0wl/money.ts) [24]

---

## 11. design decisions

### [DECIDED] iso-price will support all currencies, plus crypto

cryptocurrencies like btc, eth are not part of iso 4217, but iso-price will support them.

rationale: maximizes utility and avoids artificial limitations. users can define custom currencies with their own minor unit specifications.

### [DECIDED] division remainder allocation requires explicit opt-in

fowler's pattern suggests remainder distribution. iso-price will provide allocation functions, but they require explicit behavior options specified by the caller.

rationale: no hidden magic. the caller must explicitly declare how remainders are distributed, which prevents silent data loss and makes the behavior auditable.

### [DECIDED] round modes require explicit opt-in

financial round (half-up) vs banker's round (half-even) have different use cases. iso-price will NOT have a default round mode - callers must explicitly specify which mode to use.

rationale: no hidden magic. different financial contexts require different round modes. explicit specification prevents accidental use of the wrong mode and makes the behavior auditable.

---

### [DECIDED] IsoRates is out of scope for now

exchange rate types (IsoRate) are deferred to a future iteration. iso-price will focus on price representation and operations first.

### [DECIDED] no support for historical/obsolete currencies

iso 4217 list 3 contains historical codes. iso-price will NOT include these - only active currencies are supported.

rationale: keeps the library focused and avoids bloat. users with niche historical currency needs can define custom currencies.

---

## sources

1. [ISO 4217 - Wikipedia](https://en.wikipedia.org/wiki/ISO_4217)
2. [ISO - ISO 4217 Currency Codes](https://www.iso.org/iso-4217-currency-codes.html)
3. [Currency codes and minor units | Adyen Docs](https://docs.adyen.com/development-resources/currency-codes/)
4. [Supported currencies | Stripe Documentation](https://docs.stripe.com/currencies)
5. [The Charge object | Stripe API Reference](https://docs.stripe.com/api/charges/object)
6. [Storing currency values: data types, caveats, best practices](https://cardinalby.github.io/blog/post/best-practices/storing-currency-values-data-types/)
7. [ISO 20022: Standards | Swift](https://www.swift.com/standards/iso-20022/iso-20022-standards)
8. [Currency and Amount – ISO 20022 payments](https://www.iso20022payments.com/miscellaneous/currency-and-amount/)
9. [ISO 21041:2018 - Guidance on unit pricing](https://www.iso.org/standard/69727.html)
10. [Money | Martin Fowler](https://martinfowler.com/eaaCatalog/money.html)
11. [Fowler's Money Pattern: Precise Currency Handling in Code](https://mnorhamizan.com/fowlers-money-pattern-how-to-make-the-world-go-round/)
12. [Floating Point Numbers & Currency Rounding Errors](https://spin.atomicobject.com/2014/08/14/currency-rounding-errors/)
13. [Why You Should Never Use Float and Double for Monetary Calculations](https://dzone.com/articles/never-use-float-and-double-for-monetary-calculatio)
14. [The Floating Point Standard That's Silently Breaking Financial Software](https://medium.com/@sohail_saifii/the-floating-point-standard-thats-silently-breaking-financial-software-7f7e93430dbb)
15. [You can use floating-point numbers for money](https://www.evanjones.ca/floating-point-money.html)
16. [Floats and money](https://evertpot.com/currencies-floats/)
17. [Checking foreign exchange rates | Currencycloud](https://developer.currencycloud.com/guides/integration-guides/check-foreign-exchange-rates/)
18. [Formatting localized currency - Shopify Polaris](https://polaris-react.shopify.com/foundations/formatting-localized-currency)
19. [Currency localization: Understanding the key elements](https://poeditor.com/blog/currency-localization/)
20. [Format currency values | Microsoft Learn](https://learn.microsoft.com/en-us/globalization/locale/currency-formats)
21. [Currency Symbols Localization Guide](https://www.xtransfer.com/wiki/trade-terms/currency-symbols-localization-guide-for-beginners)
22. [What is Dinero.js?](https://v2.dinerojs.com/docs)
23. [currency-codes - npm](https://www.npmjs.com/package/currency-codes)
24. [GitHub - half0wl/money.ts](https://github.com/half0wl/money.ts)
