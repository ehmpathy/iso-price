# roadmap = iso-price words comparison & sort

execution roadmap for the blueprint.

---

## references

- wish: `0.wish.md`
- vision: `1.vision.md`
- criteria: `2.criteria.blackbox.md`
- blueprint: `3.3.blueprint.v1.i1.md`

---

## phase.1: comparison predicates

### step.1.1: isIsoPriceGreater

- [ ] create `src/domain.operations/guard/isIsoPriceGreater.ts`
- [ ] create `src/domain.operations/guard/isIsoPriceGreater.test.ts`

**acceptance criteria:**
- c.1: `isIsoPriceGreater('USD 100.00', 'USD 9.00')` returns `true`
- c.1: `isIsoPriceGreater('USD 9.00', 'USD 100.00')` returns `false`
- c.1: `isIsoPriceGreater('USD 100.00', 'USD 100.00')` returns `false`
- c.4: `isIsoPriceGreater('USD 0.01', 'USD 0.000_001')` returns `true` (mixed precision)
- c.5: `isIsoPriceGreater('USD 100.00', 'EUR 50.00')` failsfast with currency mismatch error

**verification:**
```sh
npm run test:unit -- isIsoPriceGreater
```

---

### step.1.2: isIsoPriceLesser

depends on: step.1.1 (for pattern reference)

- [ ] create `src/domain.operations/guard/isIsoPriceLesser.ts`
- [ ] create `src/domain.operations/guard/isIsoPriceLesser.test.ts`

**acceptance criteria:**
- c.2: `isIsoPriceLesser('USD 9.00', 'USD 100.00')` returns `true`
- c.2: `isIsoPriceLesser('USD 100.00', 'USD 9.00')` returns `false`
- c.2: `isIsoPriceLesser('USD 100.00', 'USD 100.00')` returns `false`
- c.4: `isIsoPriceLesser('USD 0.000_001', 'USD 0.01')` returns `true` (mixed precision)
- c.5: `isIsoPriceLesser('USD 100.00', 'EUR 50.00')` failsfast with currency mismatch error

**verification:**
```sh
npm run test:unit -- isIsoPriceLesser
```

---

### step.1.3: isIsoPriceEqual

depends on: step.1.1 (for pattern reference)

- [ ] create `src/domain.operations/guard/isIsoPriceEqual.ts`
- [ ] create `src/domain.operations/guard/isIsoPriceEqual.test.ts`

**acceptance criteria:**
- c.3: `isIsoPriceEqual('USD 100.00', 'USD 100.00')` returns `true`
- c.3: `isIsoPriceEqual('USD 1_000.00', 'USD 1000.00')` returns `true` (underscores)
- c.3: `isIsoPriceEqual('USD 0.25', 'USD 0.250_000')` returns `true` (precision normalization)
- c.3: `isIsoPriceEqual('USD 0.10', 'USD 0.100_000')` returns `true`
- c.3: `isIsoPriceEqual('USD 1.00', 'USD 1.000_000_000')` returns `true`
- c.3: `isIsoPriceEqual('USD 0.25', 'USD 0.250_001')` returns `false`
- c.5: `isIsoPriceEqual('USD 100.00', 'EUR 50.00')` failsfast with currency mismatch error

**verification:**
```sh
npm run test:unit -- isIsoPriceEqual
```

---

### step.1.4: attach predicates to isIsoPrice namespace

depends on: step.1.1, step.1.2, step.1.3

- [ ] update `src/domain.operations/guard/isIsoPrice.ts` to attach `.greater`, `.lesser`, `.equal`

**acceptance criteria:**
- `isIsoPrice.greater` is callable and delegates to `isIsoPriceGreater`
- `isIsoPrice.lesser` is callable and delegates to `isIsoPriceLesser`
- `isIsoPrice.equal` is callable and delegates to `isIsoPriceEqual`

**verification:**
```sh
npm run test:unit -- isIsoPrice
npm run test:types
```

---

## phase.2: sort operations

### step.2.1: asIsoPriceSorted

depends on: step.1.4 (predicates complete)

- [ ] create `src/domain.operations/cast/asIsoPriceSorted.ts`
- [ ] create `src/domain.operations/cast/asIsoPriceSorted.test.ts`

**acceptance criteria:**
- c.6: `asIsoPriceSorted(['USD 100.00', 'USD 9.00', 'USD 50.00'])` returns `['USD 9.00', 'USD 50.00', 'USD 100.00']` (default asc)
- c.7: `asIsoPriceSorted(prices, { order: 'asc' })` returns asc order
- c.7: `asIsoPriceSorted(prices, { order: 'desc' })` returns desc order
- c.8: `asIsoPriceSorted.asc(prices)` returns asc order
- c.8: `asIsoPriceSorted.desc(prices)` returns desc order
- c.9: original array is not mutated; new array is returned
- c.10: `asIsoPriceSorted(['USD 1.00', 'USD 0.000_001', 'USD 0.50'])` returns `['USD 0.000_001', 'USD 0.50', 'USD 1.00']` (mixed precision)
- c.11: `asIsoPriceSorted(['USD 100.00', 'EUR 50.00'])` failsfast with currency mismatch error
- c.12: `asIsoPriceSorted([])` returns `[]`
- c.13: `asIsoPriceSorted(['USD 100.00'])` returns `['USD 100.00']` with new reference
- c.14: duplicates are preserved in output
- c.15: equal values preserve relative order (stable sort)
- c.16: accepts mixed formats (words, shape, human), returns words

**verification:**
```sh
npm run test:unit -- asIsoPriceSorted
```

---

### step.2.2: attach sorted to asIsoPrice namespace

depends on: step.2.1

- [ ] update `src/domain.operations/cast/asIsoPrice.ts` to attach `.sorted`

**acceptance criteria:**
- `asIsoPrice.sorted` is callable
- `asIsoPrice.sorted.asc` is callable
- `asIsoPrice.sorted.desc` is callable

**verification:**
```sh
npm run test:unit -- asIsoPrice
npm run test:types
```

---

## phase.3: exports

### step.3.1: verify exports

depends on: step.1.4, step.2.2

- [ ] verify `src/contract/index.ts` exports `isIsoPrice` with predicates
- [ ] verify `src/contract/index.ts` exports `asIsoPrice` with sorted

**acceptance criteria:**
- `import { isIsoPrice } from 'iso-price'` includes `.greater`, `.lesser`, `.equal`
- `import { asIsoPrice } from 'iso-price'` includes `.sorted`, `.sorted.asc`, `.sorted.desc`

**verification:**
```sh
npm run build
npm run test:types
```

---

## phase.4: acceptance tests

### step.4.1: vision experience tests

depends on: step.3.1

- [ ] add acceptance tests to `src/contract/index.acceptance.test.ts`

**acceptance criteria:**
- experience.1: sort invoice line items — numeric order, not lexicographic
- experience.2: check if total exceeds budget limit — `isIsoPrice.greater` works
- experience.3: find best bid in auction — `sorted.desc[0]` returns correct value
- precision normalization works across all operations
- currency mismatch failsfast with descriptive error

**verification:**
```sh
npm run test:acceptance
```

---

## phase.5: documentation

### step.5.1: update readme

depends on: step.4.1

- [ ] add comparison section to `readme.md`
- [ ] add sort section to `readme.md`

**acceptance criteria:**
- readme documents `isIsoPrice.greater`, `.lesser`, `.equal`
- readme documents `asIsoPrice.sorted`, `.sorted.asc`, `.sorted.desc`
- examples demonstrate the string comparison footgun and the solution
- failsfast on currency mismatch is documented

**verification:**
- manual review of readme
- examples in readme are copy-paste runnable

---

## final verification

depends on: all steps complete

- [ ] `npm run build` passes
- [ ] `npm run test:types` passes
- [ ] `npm run test:unit` passes
- [ ] `npm run test:acceptance` passes
- [ ] `npm run test` passes (all tests)

---

## dependency graph

```
step.1.1 (greater)
    ↓
step.1.2 (lesser) ←───────┐
    ↓                     │
step.1.3 (equal) ←────────┤ (pattern reference)
    ↓                     │
step.1.4 (attach to isIsoPrice)
    ↓
step.2.1 (asIsoPriceSorted)
    ↓
step.2.2 (attach to asIsoPrice)
    ↓
step.3.1 (verify exports)
    ↓
step.4.1 (acceptance tests)
    ↓
step.5.1 (readme)
    ↓
final verification
```

---

## criteria coverage

| criteria | step | description |
| -------- | ---- | ----------- |
| c.1 | step.1.1 | predicate.greater |
| c.2 | step.1.2 | predicate.lesser |
| c.3 | step.1.3 | predicate.equal |
| c.4 | step.1.1-1.3 | predicate.precision-normalization |
| c.5 | step.1.1-1.3 | predicate.currency-mismatch |
| c.6 | step.2.1 | sort.default |
| c.7 | step.2.1 | sort.options |
| c.8 | step.2.1 | sort.methods |
| c.9 | step.2.1 | sort.immutable |
| c.10 | step.2.1 | sort.precision-normalization |
| c.11 | step.2.1 | sort.currency-mismatch |
| c.12 | step.2.1 | sort.empty |
| c.13 | step.2.1 | sort.single |
| c.14 | step.2.1 | sort.duplicates |
| c.15 | step.2.1 | sort.stable |
| c.16 | step.1.1-1.3, step.2.1 | input.mixed-formats |
